---
import CategoriesCarousel from '../commons/categoriesCarousel';
const { ip, collections, selectedCategory } = Astro.props;

// Agregar "All" como primera opción si no está presente
const allCategories = collections.find((col: any) => col.handle === 'all') 
    ? collections 
    : [{ handle: 'all', title: 'All Products' }, ...collections];

---
<section class="w-full h-full py-10">
    <div class="hidden flex-row gap-10 justify-center items-center sm:flex">
        {allCategories.map((category: any, index: number) => (
            <div 
                class={`category-btn w-fit h-fit py-4 px-6 rounded-full border border-primary-granite text-d-secondary font-semibold hover:bg-primary-granite hover:text-primary-lotion cursor-pointer transition-all duration-300 ${category.handle === selectedCategory ? 'active bg-primary-granite text-primary-lotion' : 'text-primary-granite'}`}
                data-category={category.handle}
            >
                {category.handle === 'all' ? 'All Products' : category.handle.replace(/-/g, ' ').replace(/\b\w/g, (l: string) => l.toUpperCase())}
            </div>
        ))}
    </div>
    <div class="flex flex-row gap-10 justify-center items-center sm:hidden">
        <CategoriesCarousel categories={allCategories} selectedCategory={selectedCategory} client:load />
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const categoryButtons = document.querySelectorAll('.category-btn');
        
        categoryButtons.forEach(button => {
            button.addEventListener('click', function(this: HTMLElement) {
                const categoryHandle = this.getAttribute('data-category');
                if (categoryHandle) {
                    // Navegar a la nueva URL con el parámetro de categoría
                    const currentUrl = new URL(window.location.href);
                    currentUrl.searchParams.set('category', categoryHandle);
                    window.location.href = currentUrl.toString();
                }
            });
        });
    });
</script>