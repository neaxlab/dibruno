---
export const prerender = false;
import Layout from '@/layouts/Layout.astro';
import Banner from '@/components/details/banner.astro';
import ChatWithUS from '@/components/faqs/chatWithUS.astro';
import { getProductByHandle } from "@/utils/shopify";
import AboutSection from '@/components/details/aboutSection.jsx';
import AboutSectionMobile from '@/components/details/aboutSectionMobile.jsx';
const { detail } = Astro.params;
import '@/components/details/information.css';

// Obtener IP del cliente de forma segura
let ip = null;
try {
    const headers = Astro.request.headers;
    ip = headers.get("x-vercel-forwarded-for") || headers.get("x-forwarded-for") || Astro.clientAddress;
} catch (error) {
    ip = null;
}

const product = await getProductByHandle({ handle: detail!, buyerIP: ip || "127.0.0.1" });
if (!product) {
    return Astro.redirect('/404');
}


---

<Layout>
    <Banner product={product} />
    <div class="w-full h-full sm:block hidden">
        <AboutSection product={product} client:load />
    </div>
    <div class="w-full h-full sm:hidden block">
        <AboutSectionMobile product={product} client:load />
    </div>
    <ChatWithUS />
</Layout>
