---
import Layout from '../../layouts/Layout.astro';
import Banner from '../../components/shop/banner.astro';
import Categories from '../../components/shop/categories.astro';
import Products from '../../components/shop/products.astro';
export const prerender = false;

import { getProductsPaginated } from "../../utils/shopify";

// Obtener IP del cliente de forma segura
let ip = null;
try {
    const headers = Astro.request.headers;
    ip = headers.get("x-vercel-forwarded-for") || headers.get("x-forwarded-for") || Astro.clientAddress;
} catch (error) {
    console.warn("No se pudo obtener la IP del cliente:", error);
    ip = null;
}
const limit = 20;
const after = null;

const { products: pageProducts, pageInfo: info } = await getProductsPaginated({ buyerIP: ip || "127.0.0.1", limit, after });
console.log(pageProducts, "pageProducts");

---

<Layout>
    <Banner />
    <Categories />
    <Products products={pageProducts} />
</Layout>
