---
export const prerender = false;
import Layout from '../../layouts/Layout.astro';
import Banner from '../../components/details/banner.astro';
import { details } from '../../constants/details/details';
import Information from '../../components/details/information.astro';

import { getProductByHandle } from "../../utils/shopify";
const { detail } = Astro.params;

// Obtener IP del cliente de forma segura
let ip = null;
try {
    const headers = Astro.request.headers;
    ip = headers.get("x-vercel-forwarded-for") || headers.get("x-forwarded-for") || Astro.clientAddress;
} catch (error) {
    console.warn("No se pudo obtener la IP del cliente:", error);
    ip = null;
}

const product = await getProductByHandle({ handle: detail!, buyerIP: ip || "127.0.0.1" });
if (!product) {
    return Astro.redirect('/404');
}
console.log(product);


---

<Layout>
    <Banner product={product} />
    <Information product={product} />   
</Layout>
